var g_storage=new myStorage,m=new lang,g_modal_url,g_modal_window_width=200,g_modal_window_height=80,g_show_modal=0,g_folder_array,g_file_array,g_root_path="",g_sharelink_openurl_key="",g_image_player_setting=null,client=new davlib.DavClient;client.initialize();function closeJqmWindow(){var c=$("div#modalWindow");$("iframe",c).attr("src","");c&&c.jqmHide()}function resizeJqmWindow(c,d){var a=$(".jqmWindow");a&&(a.css("width",c+"px"),a.css("height",d+"px"))}
function onMouseDownPicDIVHandler(c){if(c.button==2)return!1;openSelItem($(this).parents(".thumb-table-parent").find("a#list_item"))}
function openAudioPlayer(c){for(var d=[],a=0;a<g_file_array.length;a++)getFileExt(g_file_array[a].href)=="mp3"&&d.push(g_file_array[a]);if(d.length==0)alert("No audio files");else{for(var e="",b=0,a=0;a<d.length;a++){var k=d[a].href;c==k&&(b=a);e+=k;a!=d.length-1&&(e+=",")}d=$("div#modalWindow");g_modal_url="/smb/css/audio.html?a="+c+"&alist="+e+"&index="+b+"&s=0";g_modal_window_width=480;g_modal_window_height=160;$("#jqmMsg").css("display","none");$("#jqmTitleText").text(m.getString("title_audioplayer"));
d&&d.jqmShow()}}
function openImageViewer(c){for(var d=[],a=0;a<g_file_array.length;a++){var e=getFileExt(g_file_array[a].href);(e=="jpg"||e=="jpeg"||e=="png"||e=="gif")&&d.push(g_file_array[a])}if(d.length==0)alert(m.getString("msg_no_image_list"));else{for(a=e=0;a<d.length;a++)c==d[a].href&&(e=a);c="";a=getPageSize();c+='<div id="image_slide_show" class="barousel unselectable" style="height: 0; width: 0; position: fixed; background-color: rgb(0, 0, 0); left: '+a[0]/2+"px; top: "+a[1]/2+'px; z-index: 2999;">';c+=
'<div class="barousel_image">';for(a=0;a<d.length;a++){var b=d[a].href;c+=a==e?'<img src="" path="'+b+'" alt="" class="default"/>':'<img src="" path="'+b+'" alt="" class=""/>'}c+="</div>";c+='<div class="barousel_nav">';c+='<div class="barousel_content transparent" style="display: block; ">';for(a=0;a<d.length;a++)c+='<div class="',a==e&&(c+="default"),c+='" style="display: none; ">',c+='<p class="header">'+d[a].name+"</p>",c+="</div>";c+="</div>";c+="</div>";c+='<div class="barousel_loading" style="position:absolute;display:none;z-index=99;"><img src="/smb/css/load.gif" width="18px" height="18px"/></div>';
c+="</div>";$(c).animate({width:"100%",height:"100%",left:"0px",top:"0px"},200,null,null).appendTo("body");$("#image_slide_show").barousel({name:"image_slide_show",manualCarousel:1,contentResize:0,startIndex:e,storage:g_storage,stringTable:m,enableExifFunc:0,enableShareFunc:0,closeHandler:function(){g_image_player_setting=null},initCompleteHandler:function(b){g_image_player_setting=b}});d=null}}
function openSelItem(c){var d=c.attr("uhref");c.attr("qtype");var a=c.attr("isdir");c.attr("isusb");var e=c.attr("uhref");c.attr("playhref");c.attr("title");c=getFileExt(d);if((c=="mp4"||c=="m4v"||c=="wmv"||c=="avi"||c=="rmvb"||c=="rm"||c=="mpg"||c=="mpeg"||c=="mkv"||c=="mov"||c=="flv")&&isWinOS())if(isBrowser("msie")&&getInternetExplorerVersion()<=7)alert(m.getString("msg_vlcsupport"));else{d=$("div#modalWindow");a=window.location.host;a.indexOf(":")!=-1&&(a=a.substring(0,a.indexOf(":")));a="http://"+
a+":"+g_storage.get("slhp");c="/smb/css/vlc_video.html?v="+a+e;c+="&showbutton=1";e=[];for(a=0;a<g_file_array.length;a++)getFileExt(g_file_array[a].href)=="srt"&&e.push(g_file_array[a].href);if(e.length>0){c+="&s=";for(a=0;a<e.length;a++)c+=e[a],a!=e.length-1&&(c+=";")}g_modal_url=c;g_modal_window_width=655;g_modal_window_height=580;$("#jqmMsg").css("display","none");$("#jqmTitleText").text(m.getString("title_videoplayer"));d&&d.jqmShow();return}if(c=="mp3")openAudioPlayer(d);else{if(c=="doc"||c==
"docx"||c=="ppt"||c=="pptx"||c=="xls"||c=="xlsx"||c=="pdf")if((isWinOS()||isMacOS())&&!isPrivateIP()){window.open("https://docs.google.com/viewer?url="+d);return}c=="jpg"||c=="jpeg"||c=="png"||c=="gif"?openImageViewer(d):a==1?doPROPFIND(d,null,0):window.open(d)}}function sortByName(c,d){var a=c.name.toLowerCase(),e=d.name.toLowerCase();return a<e?-1:a>e?1:0}
function createThumbView(c,d,a,e){var b="";$("div#fileview").empty();if(c!=2){var k=decodeURI(d),E=decodeURI(g_root_path);k.indexOf(E)!=-1&&(b+='<div class="albumDiv">',b+='<table class="thumb-table-parent">',b+="<tbody>",b+="<tr><td>",b+='<div class="picDiv" isParent="1" popupmenu="0" uhref="',b+=d,b+='">',b+='<div class="parentDiv bicon"></div></div>',b+="</td></tr>",b+="<tr><td>",b+='<div class="albuminfo">',b+='<a id="list_item" qtype="1" isdir="1" uhref="',b+=d,b+='" title="'+m.getString("btn_prevpage")+
'" online="0">'+m.getString("btn_prevpage"),b+="</a>",b+="</div>",b+="</td></tr>",b+="</tbody>",b+="</table>",b+="</div>");for(d=0;d<a.length;d++)k=m.getString("table_filename")+": "+a[d].name,a[d].time!=""&&(k+="\n"+m.getString("table_time")+": "+a[d].time),b+='<div class="albumDiv" ',b+=' title="',b+=k,b+='">',b+='<table class="thumb-table-parent">',b+="<tbody>",b+="<tr><td>",b+='<div class="picDiv" popupmenu="',b+=c=="0"?"1":"0",b+='" uhref="',b+=a[d].href,b+='">',b+=c=="2"?a[d].type=="usbdisk"?
'<div id="fileviewicon" class="usbDiv bicon">':a[d].online=="1"?'<div id="fileviewicon" class="computerDiv bicon">':'<div id="fileviewicon" class="computerOffDiv bicon">':'<div id="fileviewicon" class="folderDiv bicon">',a[d].routersyncfolder=="1"&&(b+='<div id="routersyncicon" class="routersyncDiv sicon"></div>'),b+='<div class="selectDiv sicon"></div>',b+='<div class="selectHintDiv sicon"></div>',b+="</div></div>",b+="</td></tr>",b+="<tr><td>",b+='<div class="albuminfo">',b+='<a id="list_item" qtype="',
b+=c,b+='" isdir="1" uhref="',b+=a[d].href,b+='" title="',b+=a[d].name,b+='" online="',b+=a[d].online,b+='" ip="" mac="',b+=a[d].mac,b+='" uid="',b+=a[d].uid,b+='" freadonly="',b+=a[d].freadonly,b+='" fhidden="',b+=a[d].fhidden,b+=a[d].type=="usbdisk"?'" isusb="1"':'" isusb="0"',b+='">',b+=a[d].shortname,a[d].online=="0"&&c=="2"&&(b+="("+m.getString("title_offline")+")"),b+="</a>",b+="</div>",b+="</td></tr>",b+="<tr><td>",b+="</td></tr>",b+="</tbody>",b+="</table>",b+="</div>";for(d=0;d<e.length;d++)k=
m.getString("table_filename")+": "+e[d].name+"\n"+m.getString("table_time")+": "+e[d].time+"\n"+m.getString("table_size")+": "+e[d].size,b+='<div class="albumDiv"',b+=' title="',b+=k,b+='">',b+='<table class="thumb-table-parent">',b+="<tbody>",a=getFileExt(String(e[d].href)),a.length>5&&(a=""),b+="<tr><td>",b+=c=="0"?'<div class="picDiv" popupmenu="1" uhref="':'<div class="picDiv" popupmenu="0" uhref="',b+=e[d].href,b+='">',b+=a=="jpg"||a=="jpeg"||a=="png"||a=="gif"||a=="bmp"?'<div id="fileviewicon" class="imgfileDiv bicon">':
a=="mp3"||a=="m4a"||a=="m4r"||a=="wav"?'<div id="fileviewicon" class="audiofileDiv bicon">':a=="mp4"||a=="rmvb"||a=="m4v"||a=="wmv"||a=="avi"||a=="mpg"||a=="mpeg"||a=="mkv"||a=="mov"||a=="flv"||a=="3gp"||a=="m2v"||a=="rm"?'<div id="fileviewicon" class="videofileDiv bicon">':a=="doc"||a=="docx"?'<div id="fileviewicon" class="docfileDiv bicon">':a=="ppt"||a=="pptx"?'<div id="fileviewicon" class="pptfileDiv bicon">':a=="xls"||a=="xlsx"?'<div id="fileviewicon" class="xlsfileDiv bicon">':a=="pdf"?'<div id="fileviewicon" class="pdffileDiv bicon">':
'<div id="fileviewicon" class="fileDiv bicon">',b+='<div class="selectDiv sicon"></div>',b+='<div class="selectHintDiv sicon"></div>',b+="</div></div>",b+="</td></tr>",b+="<tr><td>",b+='<div class="albuminfo" style="font-size:80%">',b+='<a id="list_item" qtype="1" isdir="0" uhref="',b+=e[d].href,b+='" title="',b+=e[d].name,b+='" uid="',b+=e[d].uid,b+='" ext="',b+=a,b+='" freadonly="',b+=e[d].freadonly,b+='" fhidden="',b+=e[d].fhidden,b+='">',b+=e[d].shortname,b+="</a>",b+="</div>",b+="</td></tr>",
b+="<tr><td>",b+='<input type="button" class="btnDownload" value="'+m.getString("func_download")+'">',b+="</td></tr>",b+="</tbody>",b+="</table>",b+="</div>";$("div#fileview").append(b);$(".picDiv").mousedown(onMouseDownPicDIVHandler);$("input.btnDownload").click(function(){var b=$(this).parents(".thumb-table-parent").find("a#list_item"),a=b.attr("isdir"),b=b.attr("uhref");a==1?(a=$("div#modalWindow"),g_modal_url="/smb/css/download_folder.html?v="+b+"&p=slhp&a=agt&u="+g_storage.get(g_sharelink_openurl_key),
g_modal_window_width=600,g_modal_window_height=150,$("#jqmMsg").css("display","none"),$("#jqmTitleText").text(m.getString("title_download_folder")),a&&a.jqmShow()):window.open(b)});$("input.btnDownloadAll").click(function(){var b=$("div#modalWindow"),a=g_root_path,a=a.substr(0,a.lastIndexOf("/"));g_modal_url="/smb/css/download_folder.html?v="+g_root_path+"&p=slhp&a=agt&u="+a;g_modal_window_width=600;g_modal_window_height=150;$("#jqmMsg").css("display","none");$("#jqmTitleText").text(m.getString("title_download_folder"));
b&&b.jqmShow()})}}
function doPROPFIND(c,d,a){if(client!=null)try{client.PROPFIND(c,a,function(b,a,e){if(b)if(b==207){g_folder_array=[];g_file_array=[];if(window.DOMParser)b=new DOMParser,a=b.parseFromString(e,"text/xml");else if(a=new ActiveXObject("Microsoft.XMLDOM"),a.async="false",a.loadXML(e),!a.documentElement){alert("Fail to load xml!");showHideLoadStatus(!1);return}var l,n,f,j,b=a.documentElement.childNodes,e=a.documentElement.getAttribute("qtype");a.documentElement.getAttribute("readonly");a.documentElement.getAttribute("ruser");
a.documentElement.getAttribute("computername");a.documentElement.getAttribute("isusb");for(a=0;a<b.length;a++){var i="",r="",s="",o="",t="",u="",v="",w="",x="",y="",z="",A="",B="",h;j="";var C="0",p=b[a].childNodes;for(l=0;l<p.length;l++)if(p[l].nodeType==1&&p[l].nodeName=="D:propstat"){var D=p[l].childNodes;for(n=0;n<D.length;n++)if(D[n].nodeName=="D:prop"){var g=D[n].childNodes;for(f=0;f<g.length;f++)if(!(g[f].childNodes.length<=0))if(g[f].nodeName=="D:getcontenttype")r=String(g[f].childNodes[0].nodeValue);
else if(g[f].nodeName=="D:getuniqueid")s=String(g[f].childNodes[0].nodeValue);else if(g[f].nodeName=="D:getonline")u=String(g[f].childNodes[0].nodeValue);else if(g[f].nodeName=="D:getlastmodified")v=String(g[f].childNodes[0].nodeValue);else if(g[f].nodeName=="D:getcontentlength")w=String(size_format(parseInt(g[f].childNodes[0].nodeValue)));else if(g[f].nodeName=="D:getmac")y=String(g[f].childNodes[0].nodeValue);else if(g[f].nodeName=="D:getip")x=String(g[f].childNodes[0].nodeValue);else if(g[f].nodeName==
"D:gettype")z=String(g[f].childNodes[0].nodeValue);else if(g[f].nodeName=="D:getattr"){var q=g[f].childNodes;for(j=0;j<q.length;j++)if(q[j].nodeName=="D:readonly")A=q[j].childNodes[0].nodeValue;else if(q[j].nodeName=="D:hidden")B=q[j].childNodes[0].nodeValue}else g[f].nodeName=="D:getuseragent"?(j=String(g[f].childNodes[0].nodeValue),g_storage.set("user_agent",j)):g[f].nodeName=="D:getroutersync"&&(C=String(g[f].childNodes[0].nodeValue))}}else p[l].nodeType==1&&p[l].nodeName=="D:href"&&(i=String(p[l].childNodes[0].nodeValue),
n="",i.match(/^http/)&&(n=window.location.protocol+"//"+window.location.host),f=n+addPathSlash(c),i!=f?(i=i.replace(n,""),o=i.substring(i.lastIndexOf("/")+1,i.length),o!=""?(h=o,t=o=mydecodeURI(o)):i=""):i="");i!=""&&(r=="httpd/unix-directory"?g_folder_array.push({contenttype:r,href:i,name:o,uname:h,shortname:t,online:u,time:v,size:w,ip:x,mac:y,uid:s,type:z,freadonly:A,fhidden:B,routersyncfolder:C}):g_file_array.push({contenttype:r,href:i,name:o,uname:h,shortname:t,online:u,time:v,size:w,ip:x,mac:y,
uid:s,type:z,freadonly:A,fhidden:B,routersyncfolder:C}))}g_folder_array.sort(sortByName);g_file_array.sort(sortByName);h=addPathSlash(c);h!="/"&&(h=h.substring(0,h.length-1),h=h.substring(0,h.lastIndexOf("/")),h==""&&(h="/"));createThumbView(e,h,g_folder_array,g_file_array);g_storage.set(g_sharelink_openurl_key,c);$("div#fileview").scrollLeft(g_storage.get("contentscrollLeft"));$("div#fileview").scrollTop(g_storage.get("contentscrollTop"));closeJqmWindow(0);d!=void 0&&d()}else b==501?doPROPFIND(c):
alert(m.getString(b))},null,1)}catch(e){alert("catch error: "+e)}}
$(document).ready(function(){document.oncontextmenu=function(){return!1};$(document).keydown(function(c){c.keyCode==27?$("#image_slide_show").close(g_image_player_setting):c.keyCode==37?$("#image_slide_show").prev(g_image_player_setting):c.keyCode==39&&$("#image_slide_show").next(g_image_player_setting)});var c=String(window.navigator.userLanguage||window.navigator.language).toLowerCase(),c=g_storage.get("lan")==void 0?c:g_storage.get("lan");m.setLanguage(c);g_storage.set("slhp",$("div#fileview").attr("port"));
g_storage.set("agt","");g_sharelink_openurl_key=g_root_path=$("div#fileview").attr("rootpath");c=g_storage.get(g_sharelink_openurl_key);c==void 0&&(c=g_root_path);doPROPFIND(c,null,0);c="";c+="<div id='modalWindow' class='jqmWindow'>";c+="<div id='jqmTitle'>";c+="<span id='jqmTitleText'></span>";c+="</div>";c+="<div id='jqmMsg'>";c+="<span id='jqmMsgText'></span>";c+="</div>";c+="<div id='jqmContent' style='padding;0px;margin:0px'>";c+="</div>";c+="</div>";$(c).appendTo($("body"));$("input.btnDownloadAll").attr("value",
m.getString("func_downloadall"));$("#modalWindow").jqm({overlay:70,modal:!0,target:"#jqmContent",onHide:function(c){$(c.w).fadeOut("2000",function(){c.o.remove();g_show_modal=0})},onShow:function(c){var c=$(c.w),a=$("#jqmContent",c);$("#jqmTitle",c);var e=(getPageSize()[0]-g_modal_window_width)/2;g_show_modal=1;navigator.userAgent.toLowerCase();var b=function(){var a=-1;navigator.appName=="Microsoft Internet Explorer"&&/MSIE ([0-9]{1,}[.0-9]{0,})/.exec(navigator.userAgent)!=null&&(a=parseFloat(RegExp.$1));
return a};g_modal_url!=""&&(a.empty(),$("<iframe src='' frameborder='0' width='100%' height='100%'>").appendTo(a),$("iframe",c).attr("src",g_modal_url));isBrowser("msie")&&b()<=8&&(g_modal_window_height+=25);c.css({width:g_modal_window_width,height:g_modal_window_height,left:e,top:-g_modal_window_height,opacity:0,display:"block"}).jqmShow().animate({width:g_modal_window_width,height:g_modal_window_height,top:0,left:e,marginLeft:0,opacity:1},200,function(){})}})});
